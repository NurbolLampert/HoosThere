<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lights Out – HW8</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<!-- Published at: https://cs4640.cs.virginia.edu/cqq7gs/hw8/ -->
</head>
<body class="p-4">

<h1>Lights Out</h1>

<form id="gameForm" class="mb-3">
  <label for="size" class="me-2">Board size (n × n):</label>
  <input type="number" id="size" min="2" max="10" value="5" required>
  <button type="submit" class="btn btn-primary">Start Game</button>
</form>

<div id="message" class="alert alert-success d-none">You turned off all the lights!</div>
<div id="board"></div>

<script>
const OFF = "#00138b";   // dark
const ON  = "#3b52e6";   // light

const posKey = (r,c) => `r${r}c${c}`;

$("#gameForm").on("submit", function (e) {
  e.preventDefault();
  const n = parseInt($("#size").val(), 10);
  if (!n) return;

  $.getJSON("setup.php", { rows: n, cols: n }).done(setupBoard);
});

function setupBoard(data){
  $("#message").addClass("d-none");
  const { rows, cols, lights } = data;
  const lit = new Set(lights);
  const $table = $("<table>").addClass("lo-table");

  for (let r=0;r<rows;r++){
    const $tr = $("<tr>");
    for (let c=0;c<cols;c++){
      const on = lit.has(posKey(r,c));
      $("<td>")
        .attr("id", posKey(r,c))
        .toggleClass("on", on)
        .toggleClass("off", !on)
        .on("click", () => toggle(r,c,rows,cols))
        .appendTo($tr);
    }
    $table.append($tr);
  }
  $("#board").empty().append($table);
}

function toggle(r,c,rows,cols){
  const flip = (x,y) => {
    const $cell = $("#"+posKey(x,y));
    $cell.toggleClass("on off");
  };
  flip(r,c);
  if (r>0)     flip(r-1,c);
  if (r<rows-1)flip(r+1,c);
  if (c>0)     flip(r,c-1);
  if (c<cols-1)flip(r,c+1);

  /* win check */
  if ($("#board td.on").length === 0){
      $("#message").removeClass("d-none");
      $("#board td").off("click");          // disable further toggles
  }
}
</script>

<style>
    .on  { background:#3b52e6; }
    .off { background:#00138b;    }


    .lo-table{
        border-collapse: collapse;
        margin-top:1rem;
    }
    .lo-table td{
        width: 40px; height:40px;
        cursor:pointer;
        border:1px solid #444;
        transition:background .2s;
    }

    .d-none{
        display:none
        !important;
    }

    .alert{
        padding:.75rem 1.25rem;
        border:1px solid transparent;
        border-radius:.25rem
    }
    
</style>
</body>
</html>
